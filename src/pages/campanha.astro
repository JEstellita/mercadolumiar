---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProgressBar from '../components/ProgressBar.astro';
import CtaButtons from '../components/CtaButtons.astro';

// Dados padr√£o durante build - ser√£o atualizados no cliente
const progress = { 
  totalMonthly: 0, 
  goal: Number(import.meta.env.PUBLIC_GOAL_MONTHLY || 150), 
  supporters: 0, 
  stale: true 
};
---

<BaseLayout title="Campanha ‚Ä¢ Mercado Biorregional Lumiar">
  <!-- Hero Section -->
  <section class="flex flex-col items-center text-center py-8 md:py-12">
    <img src="/logo-lumiar.png" alt="Logo Mercado Biorregional Lumiar" class="w-24 h-24 mb-6" />
    <h1 class="text-3xl md:text-4xl font-bold mb-4">
      Mercado Biorregional Lumiar
    </h1>
    <p class="text-lg md:text-xl text-gray-300 mb-6 max-w-2xl">
      Um site para comprar <strong>direto de quem produz</strong> em Lumiar e Biorregi√£o.
    </p>
    <CtaButtons />
  </section>

  <!-- Progress Bar -->
  <div class="mb-8">
    <ProgressBar total={progress.totalMonthly} goal={progress.goal} supporters={progress.supporters} stale={progress.stale} />
  </div>

  <!-- Sobre a Campanha -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold mb-4">Sobre a campanha</h2>
    <div class="prose prose-invert max-w-none">
      <p class="text-gray-300 mb-4">
        Nossa meta √© criar uma plataforma sustent√°vel que conecte produtores locais com consumidores conscientes. 
        Com contribui√ß√µes mensais, conseguimos manter a infraestrutura funcionando e investir em crescimento.
      </p>
      <p class="text-gray-300">
        <strong>Meta base:</strong> R$ {progress.goal}/m√™s para cobrir plataforma e dom√≠nio.<br />
        <strong>Acima disso:</strong> tudo vai para divulga√ß√£o ‚Äî impulsionar posts, criar materiais, 
        fotografar produtos e publicar novas bancas com mais agilidade.
      </p>
    </div>
  </section>

  <!-- O que j√° est√° em andamento -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold mb-6">O que j√° est√° em andamento</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div class="border border-gray-700 rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-3 text-green-400">üåê Plataforma Online</h3>
        <p class="text-gray-300">Site responsivo funcionando com p√°ginas institucionais e sistema de assinaturas.</p>
      </div>
      <div class="border border-gray-700 rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-3 text-green-400">üí≥ Pagamentos</h3>
        <p class="text-gray-300">Integra√ß√£o com Mercado Pago para assinaturas mensais seguras e transparentes.</p>
      </div>
      <div class="border border-gray-700 rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-3 text-green-400">üìä Transpar√™ncia</h3>
        <p class="text-gray-300">Barra de progresso em tempo real conectada com planilha p√∫blica dos recursos.</p>
      </div>
      <div class="border border-gray-700 rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-3 text-green-400">üì± Contato Direto</h3>
        <p class="text-gray-300">Sistema de redirecionamento para WhatsApp facilitando contato com produtores.</p>
      </div>
      <div class="border border-gray-700 rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-3 text-green-400">üîß Infraestrutura</h3>
        <p class="text-gray-300">Hospedagem confi√°vel, dom√≠nio pr√≥prio e sistema de webhooks para automa√ß√£o.</p>
      </div>
      <div class="border border-gray-700 rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-3 text-green-400">‚ôø Acessibilidade</h3>
        <p class="text-gray-300">Design responsivo e acess√≠vel seguindo boas pr√°ticas para todos os usu√°rios.</p>
      </div>
    </div>
  </section>

  <!-- Roadmap -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold mb-6">Roadmap</h2>
    
    <div class="space-y-6">
      <!-- Conclu√≠do -->
      <div>
        <h3 class="text-lg font-semibold mb-4 text-green-400">‚úÖ Conclu√≠do</h3>
        <ul class="space-y-2 text-gray-300 ml-4">
          <li>‚Ä¢ Estrutura b√°sica do site com Astro</li>
          <li>‚Ä¢ Integra√ß√£o com Mercado Pago (assinaturas)</li>
          <li>‚Ä¢ Sistema de progresso em tempo real</li>
          <li>‚Ä¢ P√°ginas institucionais (Apoie, Sobre, Produtores)</li>
          <li>‚Ä¢ SEO b√°sico e acessibilidade</li>
        </ul>
      </div>

      <!-- Pr√≥ximo -->
      <div>
        <h3 class="text-lg font-semibold mb-4 text-yellow-400">üöß Pr√≥ximo</h3>
        <ul class="space-y-2 text-gray-300 ml-4">
          <li>‚Ä¢ Listagem p√∫blica de produtores</li>
          <li>‚Ä¢ Sistema de busca e filtros</li>
          <li>‚Ä¢ P√°gina de produtos com categorias</li>
          <li>‚Ä¢ Melhorias no design e UX</li>
        </ul>
      </div>

      <!-- Futuro -->
      <div>
        <h3 class="text-lg font-semibold mb-4 text-blue-400">üîÆ Futuro</h3>
        <ul class="space-y-2 text-gray-300 ml-4">
          <li>‚Ä¢ Sistema de pedidos online</li>
          <li>‚Ä¢ Painel administrativo</li>
          <li>‚Ä¢ App mobile</li>
          <li>‚Ä¢ Relat√≥rios e analytics avan√ßados</li>
          <li>‚Ä¢ Programa de fidelidade</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Como participar -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold mb-6">Como participar</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div class="border border-gray-700 rounded-lg p-6">
        <h3 class="text-xl font-semibold mb-4 text-green-400">ü§ù Como Apoiador</h3>
        <p class="text-gray-300 mb-4">
          Contribua mensalmente com qualquer valor. Sua doa√ß√£o ajuda a manter a plataforma funcionando 
          e a investir em melhorias cont√≠nuas.
        </p>
        <a 
          href="/assinar" 
          class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"
          aria-label="Apoiar mensalmente o Mercado Biorregional Lumiar"
          onclick="window.dispatchEvent(new CustomEvent('track', {detail:{event:'click_cta', target:'assinar'}}))"
        >
          Apoiar mensalmente
        </a>
      </div>
      
      <div class="border border-gray-700 rounded-lg p-6">
        <h3 class="text-xl font-semibold mb-4 text-blue-400">üå± Como Produtor</h3>
        <p class="text-gray-300 mb-4">
          Quer cadastrar sua banca? Entre em contato via WhatsApp para combinarmos fotos, 
          descri√ß√£o e log√≠stica.
        </p>
        <a 
          href="/whatsapp" 
          class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"
          aria-label="Entrar em contato via WhatsApp"
          onclick="window.dispatchEvent(new CustomEvent('track', {detail:{event:'click_cta', target:'whatsapp'}}))"
        >
          Falar no WhatsApp
        </a>
      </div>
    </div>
  </section>

  <!-- Comunidade -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold mb-6">Comunidade</h2>
    <div class="bg-gray-800 rounded-lg p-8 text-center">
      <h3 class="text-xl font-semibold mb-4">Junte-se √† nossa comunidade</h3>
      <p class="text-gray-300 mb-6 max-w-2xl mx-auto">
        Fa√ßa parte de uma rede de pessoas que acreditam na economia local e sustent√°vel. 
        Conecte-se com produtores, conhe√ßa hist√≥rias inspiradoras e acompanhe o crescimento 
        do mercado biorregional.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a 
          href="/whatsapp" 
          class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"
          aria-label="Entrar na comunidade via WhatsApp"
          onclick="window.dispatchEvent(new CustomEvent('track', {detail:{event:'click_cta', target:'whatsapp'}}))"
        >
          Entrar na comunidade
        </a>
        <a 
          href="/sobre" 
          class="inline-block border border-gray-600 hover:border-gray-500 text-gray-300 hover:text-white font-bold py-3 px-6 rounded-lg transition-colors"
          aria-label="Saber mais sobre o projeto"
        >
          Saber mais
        </a>
      </div>
    </div>
  </section>

  <script>
    // Atualizar dados de progresso no cliente
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const response = await fetch('/api/progresso');
        const data = await response.json();
        
        // Atualizar barra de progresso
        const progressSection = document.querySelector('[data-total]');
        if (progressSection) {
          progressSection.setAttribute('data-total', data.totalMonthly);
          progressSection.setAttribute('data-goal', data.goal);
          progressSection.setAttribute('data-supporters', data.supporters);
          
          // Atualizar percentual
          const pct = Math.min(100, Math.round((data.totalMonthly / data.goal) * 100));
          const percentElement = progressSection.querySelector('span');
          if (percentElement) percentElement.textContent = pct + '%';
          
          // Atualizar barra visual
          const barElement = progressSection.querySelector('div > div');
          if (barElement) barElement.style.width = pct + '%';
          
          // Atualizar texto
          const textElement = progressSection.querySelector('p');
          if (textElement) {
            textElement.innerHTML = `<strong>R$ ${data.totalMonthly.toFixed(2)}</strong> de R$ ${data.goal}/m√™s ‚Ä¢ ${data.supporters} assinantes`;
          }
        }
        
        // Dispatch view_progress event
        window.dispatchEvent(new CustomEvent('track', {
          detail: {
            event: 'view_progress',
            total: data.totalMonthly,
            goal: data.goal,
            supporters: data.supporters
          }
        }));
      } catch (error) {
        console.log('Erro ao carregar progresso:', error);
      }
    });
  </script>
</BaseLayout>
